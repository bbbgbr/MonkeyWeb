let genTutor=(()=>{var c=_asyncToGenerator(function*(){let d=yield $.post("post/v1/listTutor");for(let e in d.sort(function(e,f){return e.tutorID-f.tutorID}),d)$("#crFilterPick").append("<option value="+d[e].tutorID+">"+d[e].nicknameEn+"</option>");genTable(2)});return function(){return c.apply(this,arguments)}})(),genTable=(()=>{var c=_asyncToGenerator(function*(d){let e;1===d?($("#fhbAbsentTable").empty(),$("#fhbPresentTable").empty(),e=$("#fhbDatePicker").data("DateTimePicker").date()):($("#crAbsentTable").empty(),e=$("#crDatePicker").data("DateTimePicker").date()),e.hour(0);let f=yield $.post("post/v1/listAttendance",{date:e.valueOf()});for(let g=0;g<f.length;g++){let m,n,o,h=moment(f[g].timestamp).format("ddd DD/MM/YY HH:mm"),k=moment(f[g].date).hour(),l="";switch(o=void 0!==f[g].link&&""!==f[g].link?"<span class='fas fa-fw fa-lg fa-folder-open' onclick='showAdtendPic(\""+f[g].link+"\")'></span>":"<span class='fas fa-fw fa-lg fa-plus-circle' onclick='showUploadModal(\""+f[g]._id+"\")'></span>",emergencyAbsent(f[g].timestamp,f[g].date)&&(l="table-warning"),f[g].remark){case"1":m="<span class='far fa-fw fa-lg fa-check-circle' style='color:orange'></span>",n="next2";break;case"2":m="<span class='far fa-fw fa-lg fa-check-circle' style='color:green'></span>",n="next0";break;default:m="<span class='far fa-fw fa-lg fa-times-circle' style='color:red'></span>",n="next1";}if(1===f[g].type){let p,q;void 0===f[g].courseID?(p="FHB:"+f[g].hybridSubject,q="FHB"):"Hybrid"===f[g].tutorName?(p="CR:"+f[g].courseName,q="HB"):(p="CR:"+f[g].courseName,q="CR"),"CR"!==q&&1===d?$("#fhbAbsentTable").append("<tr id='"+f[g]._id+"' class='fhbTableRow fhbRow"+k+" "+q+" "+l+"'><td class='text-center'>"+h+"</td><td class='text-center' onclick='gotoStdProfile(\""+f[g].studentID+"\")'>"+f[g].nickname+" "+f[g].firstname+"</td><td class='text-center'>"+p+"</td><td class='text-center'>HB</td><td class='text-center'>"+f[g].reason+"</td><td class='text-center'>"+o+"</td><td class='text-center "+n+" rm"+f[g]._id+"' onclick='setRemark(\""+f[g]._id+"\")'>"+m+"</td><td class='text-center'><button class='btn btn-light col' onclick='removeAdtend(\""+f[g]._id+"\")'><span class='fas fa-fw fa-lg fa-trash' style='color:red'></span></button></td></tr>"):"FHB"!==q&&2==d&&$("#crAbsentTable").append("<tr id='"+f[g]._id+"' class='crTableRow crRow"+k+" "+f[g].tutorID+" "+l+"'><td class='text-center'>"+h+"</td><td class='text-center' onclick='gotoStdProfile(\""+f[g].studentID+"\")'>"+f[g].nickname+" "+f[g].firstname+"</td><td class='text-center'>"+p+"</td><td class='text-center'>"+("Hybrid"===f[g].tutorName?"HB":f[g].tutorName)+"</td><td class='text-center'>"+f[g].reason+"</td><td class='text-center'>"+o+"</td><td class='text-center "+n+" rm"+f[g]._id+"' onclick='setRemark(\""+f[g]._id+"\")'>"+m+"</td><td class='text-center'><button class='btn btn-light col' onclick='removeAdtend(\""+f[g]._id+"\")'><span class='fas fa-fw fa-lg fa-trash' style='color:red'></span></button></td></tr>")}else if(1===d){let p;p=void 0===f[g].courseID?"FHB:"+f[g].subject:"Hybrid"===f[g].tutorName?"CR:"+f[g].courseName:"CR:"+f[g].courseName,$("#fhbPresentTable").append("<tr id='"+f[g]._id+"' class='fhbTableRow fhbRow"+k+"'><td class='text-center'>"+h+"</td><td class='text-center' onclick='gotoStdProfile(\""+f[g].studentID+"\")'>"+f[g].nickname+" "+f[g].firstname+"</td><td class='text-center'>"+p+"</td><td class='text-center'>"+(null===f[g].reason?"":f[g].reason)+"</td><td class='text-center "+n+" rm"+f[g]._id+"' onclick='setRemark(\""+f[g]._id+"\")'>"+m+"</td><td class='text-center'><button class='btn btn-light col' onclick='removeAdtend(\""+f[g]._id+"\")'><span class='fas fa-fw fa-lg fa-trash' style='color:red'></span></button></td></tr>")}}filterFhbTable(1),filterFhbTable(2)});return function(){return c.apply(this,arguments)}})(),genActivityTable=(()=>{var c=_asyncToGenerator(function*(d){acTime1.date(acTime1.date()-4),0!==d&&acTime2.date(acTime2.date()-4);let e=yield $.post("post/v1/listAttendance",{startDate:acTime1.valueOf(),endDate:acTime2.valueOf()});for(let f=0;f<e.length;f++){let g,h=moment(e[f].timestamp).format("ddd DD/MM/YY - HH:mm"),k,l=moment(e[f].date).format("ddd DD/MM/YY - HH:mm"),m,n;1===e[f].type?(g="table-danger",k=void 0===e[f].courseID?"FHB:"+e[f].hybridSubject:"CR:"+e[f].courseName,m=e[f].reason):(g="table-success",k=void 0===e[f].courseID?"FHB:"+e[f].subject:"CR:"+e[f].courseName,m=null===e[f].reason?"-":e[f].reason),n=void 0!==e[f].link&&""!==e[f].link?"<span class='fas fa-fw fa-lg fa-folder-open' onclick='showAdtendPic(\""+e[f].link+"\")'></span>":"<span class='fas fa-fw fa-lg fa-plus-circle' onclick='showUploadModal(\""+e[f].attendanceID+"\")'></span>",$("#acTableBody").append("<tr class='"+g+"' id='"+e[f]._id+"'><td class='text-center'>"+h+"</td><td class='text-center' onclick='gotoStdProfile(\""+e[f].studentID+"\")'>"+e[f].nickname+" "+e[f].firstname+"</td><td class='text-center'>"+k+"</td><td class='text-center'>"+l+"</td><td class='text-center'>"+m+"</td><td class='text-center'>"+n+"</td><td class='text-center'>"+e[f].sender+"</td><td class='text-center'><button class='btn btn-light col' onclick='removeAdtend(\""+e[f]._id+"\")'><span class='fas fa-fw fa-lg fa-trash' style='color:red'></span></button></td></tr>")}});return function(){return c.apply(this,arguments)}})(),generateChart=(()=>{var c=_asyncToGenerator(function*(d){let e=yield $.post("post/v1/allRoom"),f={};for(let Q in e)f[Q]=e[Q].room0;let g=[0,0,0,0,0,0,0,0,0,0],h=[0,0,0,0,0,0,0,0,0,0],k=[0,0,0,0,0,0,0,0,0,0],l=[0,0,0,0,0,0,0,0,0,0],m=[0,0,0,0,0,0,0,0,0,0],n=[0,0,0,0,0,0,0,0,0,0],o=[0,0,0,0,0,0,0,0,0,0],p=[0,0,0,0,0,0,0,0,0,0],q=[0,0,0,0,0,0,0,0,0,0],r=[0,0,0,0,0,0,0,0,0,0],s=[0,0,0,0,0,0,0,0,0,0],u=[0,0,0,0,0,0,0,0,0,0],v=[0,0,0,0,0,0,0,0,0,0],w=[0,0,0,0,0,0,0,0,0,0],x=[0,0,0,0,0,0,0,0,0,0],y=[0,0,0,0,0,0,0,0,0,0],z=[0,0,0,0,0,0,0,0,0,0],A=[0,0,0,0,0,0,0,0,0,0],B=[0,0,0,0,0,0,0,0,0,0];const C=function(Q){switch(Q){case"tue17":return 0;case"thu17":return 1;case"sat8":return 2;case"sat10":return 3;case"sat13":return 4;case"sat15":return 5;case"sun8":return 6;case"sun10":return 7;case"sun13":return 8;case"sun15":return 9;default:}};for(let Q in f)if(g[C(Q)]=f[Q].maxStudent,h[C(Q)]=f[Q].hybrid[0].numMath,k[C(Q)]=f[Q].hybrid[0].numPhysics,l[C(Q)]=f[Q].hybrid[0].numChemistry,m[C(Q)]=f[Q].hybrid[0].numEnglish,s[C(Q)]=f[Q].hybrid[0].numMath,u[C(Q)]=f[Q].hybrid[0].numPhysics,v[C(Q)]=f[Q].hybrid[0].numChemistry,w[C(Q)]=f[Q].hybrid[0].numEnglish,void 0!==f[Q].course){let R=f[Q].course;for(let S in R)switch(R[S].courseName.slice(0,1)){case"M":n[C(Q)]+=R[S].num,x[C(Q)]+=R[S].num;break;case"P":o[C(Q)]+=R[S].num,y[C(Q)]+=R[S].num;break;case"C":p[C(Q)]+=R[S].num,z[C(Q)]+=R[S].num;break;case"E":q[C(Q)]+=R[S].num,A[C(Q)]+=R[S].num;break;default:}}for(let Q in r)r[Q]=g[Q]-h[Q]-k[Q]-n[Q]-o[Q]-p[Q]-q[Q];const D=function(Q){for(let R in Q)0===Q[R]?Q[R]="":0>Q[R]&&(Q[R]=-1*Q[R]/100)};let E=moment();E.hour(0).minute(0).second(0).millisecond(0);let F;switch(E.day()){case 0:F=[0,2,4,6];break;case 1:F=[6,1,3,5];break;case 2:F=[5,0,2,4];break;case 3:F=[4,6,1,3];break;case 4:F=[3,5,0,2];break;case 5:F=[2,4,6,1];break;case 6:F=[1,3,5,0];}let G=moment(E);G.date(E.date()+F[0]);let H=moment(E);H.date(E.date()+F[1]);let I=moment(E);I.date(E.date()+F[2]);let J=moment(E);J.date(E.date()+F[3]);let K=[$.post("post/v1/listAttendance",{date:G.valueOf()}),$.post("post/v1/listAttendance",{date:H.valueOf()}),$.post("post/v1/listAttendance",{date:I.valueOf()}),$.post("post/v1/listAttendance",{date:J.valueOf()})],L=yield Promise.all(K);for(let Q in L){let R=L[Q];for(let S in R)if(1===R[S].type){let T=moment(R[S].date).format("dddH").toLowerCase();if("tue8"!==T&&"tue10"!==T&&"tue13"!==T&&"thu8"!==T&&"thu10"!==T&&"thu13"!==T)if(void 0===R[S].courseID)"M"===R[S].hybridSubject?s[C(T)]-=1:"P"===R[S].hybridSubject?u[C(T)]-=1:"C"===R[S].hybridSubject?v[C(T)]-=1:"E"===R[S].hybridSubject&&(w[C(T)]-=1);else if(99000===R[S].tutorID)for(let U in f[T].course)if(f[T].course[U].courseID===R[S].courseID)switch(R[S].courseName.slice(0,1)){case"M":x[C(T)]-=1;break;case"P":y[C(T)]-=1;break;case"C":z[C(T)]-=1;break;case"E":A[C(T)]-=1;break;default:}}else if(2===R[S].type){let T=moment(R[S].date).format("dddH").toLowerCase();switch(R[S].subject){case"M":s[C(T)]+=1;break;case"P":u[C(T)]+=1;break;case"C":v[C(T)]+=1;break;case"E":w[C(T)]+=1;break;default:}}}for(let Q in B)B[Q]=g[Q]-s[Q]-u[Q]-v[Q]-w[Q]-x[Q]-y[Q]-z[Q]-A[Q];D(h),D(k),D(l),D(m),D(n),D(o),D(p),D(q),D(r),D(s),D(u),D(v),D(w),D(x),D(y),D(z),D(A),D(B);let M=[];const N=function(Q,R,S,T,U,V){void 0===V?M.push({type:"bar",label:Q,stack:"Stack "+S,data:R,backgroundColor:T,borderColor:T,borderWidth:1,datalabels:{color:U,font:{style:"bold",size:14}}}):M.push({type:"bar",label:Q,stack:"Stack "+S,data:R,backgroundColor:T,borderColor:V,borderWidth:3,datalabels:{color:U,font:{style:"bold",size:14}}})},O=function(Q,R){for(let S in Q.splice(0,Q.length),R)Q.push(R[S])};if(M.push({type:"line",label:"max",data:g,backgroundColor:"rgba(0,0,0,0)",borderColor:"black",borderDash:[15,10],borderWidth:3,pointBorderColor:"rgba(0,0,0,0)",datalabels:{display:!1}}),firstTimeGen){N("MHB(Static)",h,0,"rgb(255,153,0)","white"),N("PHB(Static)",k,0,"rgb(212,0,255)","white"),N("CHB(Static)",l,0,"#ff8af3","white"),N("EHB(Static)",m,0,"#bdbdbd","white"),N("Math(Static)",n,0,"rgba(0,0,0,0)","rgb(255,153,0)","rgb(255,153,0)"),N("Phy(Static)",o,0,"rgba(0,0,0,0)","rgb(212,0,255)","rgb(212,0,255)"),N("Che(Static)",p,0,"rgba(0,0,0,0)","#ff8af3","#ff8af3"),N("Eng(Static)",q,0,"rgba(0,0,0,0)","#bdbdbd","#bdbdbd"),M.push({type:"bar",label:"Remaining",stack:"Stack 0",data:r,backgroundColor:"rgba(0,0,0,0)",borderColor:"rgba(0,0,0,0)",borderWidth:2,datalabels:{font:{style:"bold",size:16},color:"#6eb339",anchor:"start",align:"end",offset:1,formatter:function(Q){return""===Q?"":1>Q?"( -"+100*Q+" )":"( "+Q+" )"}}}),N("MHB(Real)",s,1,"#e64500","white"),N("PHB(Real)",u,1,"#8a00e0","white"),N("CHB(Real)",v,1,"#ff3dec","white"),N("EHB(Real)",w,1,"#9e9e9e","white"),N("Math(Real)",x,1,"rgba(0,0,0,0)","#e64500","#e64500"),N("Phy(Real)",y,1,"rgba(0,0,0,0)","#8a00e0","#8a00e0"),N("Che(Real)",z,1,"rgba(0,0,0,0)","#ff3dec","#ff3dec"),N("Eng(Real)",A,1,"rgba(0,0,0,0)","#9e9e9e","#9e9e9e"),M.push({type:"bar",label:"Remaining(Real)",stack:"Stack 1",data:B,backgroundColor:"rgba(0,0,0,0)",borderColor:"rgba(0,0,0,0)",borderWidth:2,datalabels:{font:{style:"bold",size:16},color:"#efec2d",anchor:"start",align:"end",offset:1,formatter:function(Q){return""===Q?"":1>Q?"( -"+100*Q+" )":"( "+Q+" )"}}});var P=document.getElementById("fhbChart").getContext("2d");myChart=new Chart(P,{type:"bar",data:{labels:["tue ("+H.format("DD/MM")+")","thu ("+I.format("DD/MM")+")","sat8 ("+J.format("DD/MM")+")","sat10 ("+J.format("DD/MM")+")","sat13 ("+J.format("DD/MM")+")","sat15 ("+J.format("DD/MM")+")","sun8 ("+G.format("DD/MM")+")","sun10 ("+G.format("DD/MM")+")","sun13 ("+G.format("DD/MM")+")","sun15 ("+G.format("DD/MM")+")"],datasets:M},options:{title:{display:!0,fontSize:24,text:"HB Student Chart"},tooltips:{mode:"point",intersect:!1},legend:{position:"bottom",display:!1},responsive:!0,scales:{xAxes:[{stacked:!0}],yAxes:[{stacked:!0,ticks:{beginAtZero:!0}}]}}}),firstTimeGen=!1}else switch(d){case 1:N("MHB(Static)",h,0,"rgb(255,153,0)","white"),N("PHB(Static)",k,0,"rgb(212,0,255)","white"),N("CHB(Static)",l,0,"#ff8af3","white"),N("EHB(Static)",m,0,"#bdbdbd","white"),N("Math(Static)",n,0,"rgba(0,0,0,0)","rgb(255,153,0)","rgb(255,153,0)"),N("Phy(Static)",o,0,"rgba(0,0,0,0)","rgb(212,0,255)","rgb(212,0,255)"),N("Che(Static)",p,0,"rgba(0,0,0,0)","#ff8af3","#ff8af3"),N("Eng(Static)",q,0,"rgba(0,0,0,0)","#bdbdbd","#bdbdbd"),M.push({type:"bar",label:"Remaining",stack:"Stack 0",data:r,backgroundColor:"rgba(0,0,0,0)",borderColor:"rgba(0,0,0,0)",borderWidth:2,datalabels:{font:{style:"bold",size:16},color:"#6eb339",anchor:"start",align:"end",offset:1,formatter:function(Q){return""===Q?"":1>Q?"( -"+100*Q+" )":"( "+Q+" )"}}}),O(myChart.data.datasets,M),myChart.update();break;case 3:N("MHB(Static)",h,0,"rgb(255,153,0)","white"),N("PHB(Static)",k,0,"rgb(212,0,255)","white"),N("CHB(Static)",l,0,"#ff8af3","white"),N("EHB(Static)",m,0,"#bdbdbd","white"),N("Math(Static)",n,0,"rgba(0,0,0,0)","rgb(255,153,0)","rgb(255,153,0)"),N("Phy(Static)",o,0,"rgba(0,0,0,0)","rgb(212,0,255)","rgb(212,0,255)"),N("Che(Static)",p,0,"rgba(0,0,0,0)","#ff8af3","#ff8af3"),N("Eng(Static)",q,0,"rgba(0,0,0,0)","#bdbdbd","#bdbdbd"),M.push({type:"bar",label:"Remaining",stack:"Stack 0",data:r,backgroundColor:"rgba(0,0,0,0)",borderColor:"rgba(0,0,0,0)",borderWidth:2,datalabels:{font:{style:"bold",size:16},color:"#6eb339",anchor:"start",align:"end",offset:1,formatter:function(Q){return""===Q?"":1>Q?"( -"+100*Q+" )":"( "+Q+" )"}}});case 2:N("MHB(Real)",s,1,"#e64500","white"),N("PHB(Real)",u,1,"#8a00e0","white"),N("CHB(Real)",v,1,"#ff3dec","white"),N("EHB(Real)",w,1,"#9e9e9e","white"),N("Math(Real)",x,1,"rgba(0,0,0,0)","#e64500","#e64500"),N("Phy(Real)",y,1,"rgba(0,0,0,0)","#8a00e0","#8a00e0"),N("Che(Real)",z,1,"rgba(0,0,0,0)","#ff3dec","#ff3dec"),N("Eng(Real)",A,1,"rgba(0,0,0,0)","#9e9e9e","#9e9e9e"),M.push({type:"bar",label:"Remaining(Real)",stack:"Stack 1",data:B,backgroundColor:"rgba(0,0,0,0)",borderColor:"rgba(0,0,0,0)",borderWidth:2,datalabels:{font:{style:"bold",size:16},color:"#efec2d",anchor:"start",align:"end",offset:1,formatter:function(Q){return""===Q?"":1>Q?"( -"+100*Q+" )":"( "+Q+" )"}}}),O(myChart.data.datasets,M),myChart.update();break;default:}fixWindowHeight()});return function(){return c.apply(this,arguments)}})(),genSmTable=(()=>{var c=_asyncToGenerator(function*(){let d=$("#smDatePicker").data("DateTimePicker").date(),e=$("#smTimePicker").val();0!==parseInt(e)&&d.hour(parseInt(e));let g,f=yield $.post("post/v1/listAttendance",{date:d.valueOf()});for(let h in g=0===parseInt(e)?f:f.filter(function(h){let k=moment(h.date);return k.hour()===parseInt(e)}),$("#smAbsentTableBody").empty(),$("#smPresentTableBody").empty(),g){let k=99000===g[h].tutorID?"HB":"CR";1===g[h].type?"summerabsent"===g[h].reason.toLowerCase()&&$("#smAbsentTableBody").append("<tr id='"+g[h]._id+"' class='smrow-"+k+"'><td class='text-center'>"+g[h].nickname+" "+g[h].firstname+"</td><td class='text-center'>"+g[h].courseName+"</td><td class='text-center'>"+g[h].tutorName+"</td><td class='text-center'><button class='col btn btn-light' onclick='removeAdtend(\""+g[h]._id+"\");'><span class='fa fa-lg fa-trash text-danger'></span></button></td></tr>"):2===g[h].type&&void 0!==g[h].courseID&&$("#smPresentTableBody").append("<tr id='"+g[h]._id+"' class='smrow-"+k+"'><td class='text-center'>"+g[h].nickname+" "+g[h].firstname+"</td><td class='text-center'><button class='col btn btn-light' onclick='removeAdtend(\""+g[h]._id+"\");'><span class='fa fa-lg fa-trash text-danger'></span></button></td></tr>")}filterSmData()});return function(){return c.apply(this,arguments)}})(),genSmCrSelectOption=(()=>{var c=_asyncToGenerator(function*(){let d=yield getConfig(),e=d.defaultQuarter.summer,f=yield $.post("post/v1/allCourse",{year:e.year,quarter:e.quarter});for(let g in $("#smCoursePicker").append("<option value='0'>Select course</option>"),f)$("#smCoursePicker").append("<option value="+f[g].courseID+">"+f[g].courseName+"-"+f[g].tutorName+"</option>")});return function(){return c.apply(this,arguments)}})(),genSmByCrTable=(()=>{var c=_asyncToGenerator(function*(){let d=$("#smByCrTableBody");d.empty();let e=$("#smCoursePicker").val(),f=yield courseInfo(e),g=[],h=moment("2018/03/12","YYYY/MM/DD").utcOffset(7),k=moment("2018/03/30 23","YYYY/MM/DD HH").utcOffset(7);for(let m in f.student)g.push($.post("post/v1/listAttendance",{studentStartDate:h.valueOf(),studentEndDate:k.valueOf(),studentID:f.student[m]}));let l=yield Promise.all(g);for(let m in l){let n,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(let p in l[m]){let q=moment(l[m][p].date);2===l[m][p].type&&15===q.hour()?o[smDayToNo(q.date())]=1:1===l[m][p].type&&l[m][p].courseID===e&&(o[smDayToNo(q.date())]=-1)}if(0<l[m].length){n=l[m][0].nickname+" "+l[m][0].firstname;let p="";for(let q in o)-1===o[q]?p+="<td class='table-danger'></td>":0===o[q]?p+="<td></td>":1===o[q]&&(p+="<td class='table-success'></td>");d.append("<tr><td>"+n+"</td>"+p+"</tr>")}}});return function(){return c.apply(this,arguments)}})(),initAddAttendData=(()=>{var c=_asyncToGenerator(function*(){$("#addAttendReasonContainer").show(),$("#addAttendTimeContainer").hide();let d,e;try{[d,e]=yield Promise.all([allStudent(),getConfig()]);let f=[];for(let g in d.student)f.push({name:d.student[g].nickname+" "+d.student[g].firstname+" ("+d.student[g].studentID+")",id:d.student[g].studentID});$("#addStdTypeahead").typeahead({source:f,autoSelect:!0}),$("#addAttendQuarterSelect").append("<option value='"+e.defaultQuarter.quarter.year+"-"+e.defaultQuarter.quarter.quarter+"'>Default</option><option value='"+e.defaultQuarter.summer.year+"-"+e.defaultQuarter.summer.quarter+"'>Summer</option>")}catch(f){log("post/allStudent||post/getConfig is error.")}});return function(){return c.apply(this,arguments)}})(),genAddAbsentSubj=(()=>{var c=_asyncToGenerator(function*(){let d=$("#addStdTypeahead").typeahead("getActive");if(d!==void 0){let e=$("#addAttendQuarterSelect").val();try{let f=yield $.post("post/v1/studentTimeTable",{year:e.slice(0,4),quarter:e.slice(5),studentID:d.id});$("#addAttendSubjSelect").empty();let g=$("#addAttendDatePicker").data("DateTimePicker").date();if(10>parseInt(e.slice(5))){for(let h in f.hybrid){let k=moment(f.hybrid[h].day);k.day()===g.day()&&$("#addAttendSubjSelect").append("<option value='"+f.hybrid[h].hybridID+"'>FHB:"+f.hybrid[h].subject+" ("+k.format("HH:00")+")</option>")}for(let h in f.course){let k=moment(f.course[h].day);k.day()===g.day()&&$("#addAttendSubjSelect").append("<option value='"+f.course[h].courseID+"'>"+f.course[h].courseName+"-"+f.course[h].tutorName+" ("+k.format("HH:00")+")</option>")}}else for(let h in f.course){let k=moment(f.course[h].day);0!==g.day()&&6!==g.day()&&$("#addAttendSubjSelect").append("<option value='"+f.course[h].courseID+"'>"+f.course[h].courseName+"-"+f.course[h].tutorName+" ("+k.format("HH:00")+")</option>")}}catch(f){log("post/v1/studentTimeTable is error.")}}});return function(){return c.apply(this,arguments)}})(),genAddPresentSubj=(()=>{var c=_asyncToGenerator(function*(){let d=$("#addStdTypeahead").typeahead("getActive");if(d!==void 0){let e=$("#addAttendDatePicker").data("DateTimePicker").date(),f=$("#addAttendQuarterSelect").val();try{let g=yield $.post("post/v1/studentTimeTable",{year:f.slice(0,4),quarter:f.slice(5),studentID:d.id});for(let h in $("#addAttendSubjSelect").empty(),10>parseInt(f.slice(5))&&(0===e.day()||2===e.day()||4===e.day()||6===e.day())&&$("#addAttendSubjSelect").append("<option value='0'>FHB:M</option><option value='0'>FHB:P</option>"),g.course){let k=moment(g.course[h].day);$("#addAttendSubjSelect").append("<option value='"+g.course[h].courseID+"'>"+g.course[h].courseName+"-"+g.course[h].tutorName+" ("+k.format("HH:00")+")</option>")}}catch(g){log("post/v1/studentTimeTable is error.")}}});return function(){return c.apply(this,arguments)}})(),addNewAbsentAttend=(()=>{var c=_asyncToGenerator(function*(){$("#waitingModal").modal("show");let d={userID:$("#addStdTypeahead").typeahead("getActive").id,reason:$("#addAttendReasonInput").val(),sender:"Admin"},e=$("#addAttendDatePicker").data("DateTimePicker").date(),f=$("#addAttendSubjSelect option:selected").html(),g=$("#addAttendSubjSelect").val(),h=parseInt(f.slice(f.indexOf("(")+1,-4));d.date=e.hour(h).valueOf(),0<=f.indexOf("FHB")?d.hybridID=g:d.courseID=g;try{let k=yield $.post("post/v1/addStudentAbsent",d);log(k),location.reload()}catch(k){log("post/v1/addStudentAbsent is error.")}});return function(){return c.apply(this,arguments)}})(),addNewPresentAttend=(()=>{var c=_asyncToGenerator(function*(){$("#waitingModal").modal("show");let d={},e=$("#addAttendQuarterSelect").val();d.userID=$("#addStdTypeahead").typeahead("getActive").id,d.sender="Admin";let f=$("#addAttendDatePicker").data("DateTimePicker").date(),g=$("#addAttendSubjSelect option:selected").html(),h=$("#addAttendSubjSelect").val(),k=$("#addAttendTimeSelect").val();d.date=f.hour(parseInt(k)).valueOf(),0<$("#addAttendReasonInput").val().length&&(d.reason=$("#addAttendReasonInput").val());let l=!0;if(0<=g.indexOf("FHB")){d.subject=g.slice(4,5);try{let m=yield $.post("post/v1/listHybridDayInQuarter",{year:e.slice(0,4),quarter:e.slice(5)});for(let n in m){let o=moment(m[n].day);o.day()===f.day()&&o.hour()===parseInt(k)&&(d.hybridID=m[n].hybridID)}d.hybridID===void 0&&(alert("Please correct selected time."),l=!1)}catch(m){log("post/v1/listHybridDayInQuarter is error."),l=!1}}else d.courseID=h;if(l)try{let m=yield $.post("post/v1/addStudentPresent",d);log(m),location.reload()}catch(m){log("post/v1/addStudentPresent is error.")}});return function(){return c.apply(this,arguments)}})(),calStdQuota=(()=>{var c=_asyncToGenerator(function*(){let d=$("#addStdTypeahead").typeahead("getActive"),e=yield listQuarter("private");if(d!==void 0){let f=$("#addAttendQuarterSelect").val(),g=moment(),h=parseInt(f.slice(0,4)),k=parseInt(f.slice(5)),l,m;for(let n in e.quarter)e.quarter[n].year===h&&e.quarter[n].quarter===k&&(l=e.quarter[n].startDate,m=e.quarter[n].endDate);try{let[n,o,p]=yield Promise.all([$.post("post/v1/studentTimeTable",{year:h,quarter:k,studentID:d.id}),$.post("post/v1/listQuota",{studentID:d.id}),$.post("post/v1/listAttendance",{studentStartDate:l,studentEndDate:m,studentID:d.id})]),q=0,r=0,s=0,u=0;for(let v in n.hybrid)switch(n.hybrid[v].subject){case"M":q+=2;break;case"P":r+=2;break;default:}for(let v in p)if(1===p[v].type)switch(p[v].hybridSubject){case"M":s+=1;break;case"P":u+=1;break;default:}else if(2===p[v].type)switch(p[v].subject){case"M":s-=1;break;case"P":u-=1;break;default:}for(let v in $("#addQuotaTableBody").empty(),o.quotaCount){switch(o.quotaCount[v]._id){case"M":s-=o.quotaCount[v].value;break;case"P":u-=o.quotaCount[v].value;break;default:}$("#addQuotaTableBody").append("<tr><td class='text-center'>"+o.quotaCount[v]._id+"</td><td class='text-center'>"+o.quotaCount[v].value+"</td></tr>")}$("#mathQuotaBtn").html("FHB:M "+(q-s)+"/"+q),$("#phyQuotaBtn").html("FHB:P "+(r-u)+"/"+r)}catch(n){log("Request error.")}}});return function(){return c.apply(this,arguments)}})();function _asyncToGenerator(c){return function(){var d=c.apply(this,arguments);return new Promise(function(e,f){function g(h,k){try{var l=d[h](k),m=l.value}catch(n){return void f(n)}return l.done?void e(m):Promise.resolve(m).then(function(n){g("next",n)},function(n){g("throw",n)})}return g("next")})}}let year,quarter;getYearAndQuarter();function getYearAndQuarter(){getConfig().then(c=>{year=c.defaultQuarter.quarter.year,quarter=c.defaultQuarter.quarter.quarter})}$("#fhbDatePicker").datetimepicker({format:"DD/MM/YYYY",daysOfWeekDisabled:[1,3,5]}),$("#crDatePicker").datetimepicker({format:"DD/MM/YYYY",daysOfWeekDisabled:[1,2,3,4,5]});let fhbIndicator=!0,crIndicator=!0;genTimePicker(1),genTimePicker(2),$(".nav-tabs > .nav-item:nth-child(2)").click(function(){fhbIndicator&&genTable(1),fhbIndicator=!1}),$(".nav-tabs > .nav-item:nth-child(3)").click(function(){crIndicator&&genTutor(),crIndicator=!1}),$("#fhbDatePicker").on("dp.change",function(){genTimePicker(1),genTable(1)}),$("#crDatePicker").on("dp.change",function(){genTimePicker(2),genTable(2)});function genTimePicker(c){let d,e;1===c?(d=$("#fhbTimePick"),e=$("#fhbDatePicker").data("DateTimePicker").date()):(d=$("#crTimePick"),e=$("#crDatePicker").data("DateTimePicker").date()),d.empty(),2===e.day()||4===e.day()?d.append("<option value=17>17-19</option>"):d.append("<option value=0>All</option><option value=8>8-10</option><option value=10>10-12</option><option value=13>13-15</option><option value=15>15-17</option>")}function emergencyAbsent(c,d){let e=!1,f=86400000,g=moment(d);return g.hour(18).minute(0).second(0).millisecond(0),0===g.day()?g.valueOf()-moment(c).valueOf()<2*f&&(e=!0):g.valueOf()-moment(c).valueOf()<f&&(e=!0),e}function filterFhbTable(c){let d,e;if(1===c?(d=$("#fhbTimePick").val(),e=$("#fhbFilterPick").val()):(d=$("#crTimePick").val(),e=$("#crFilterPick").val()),1===c)switch("0"===d?$(".fhbTableRow").show():($(".fhbTableRow").hide(),$(".fhbRow"+d).show()),e){case"FHB":$(".HB").hide();break;default:}else if("0"!==d){let f=["8","10","13","15"];"0"===e?$(".crTableRow").show():($(".crTableRow").hide(),$("."+e).show());for(let g=0;4>g;g++)f[g]!==d&&$(".crRow"+f[g]).hide()}else"0"===e?$(".crTableRow").show():($(".crTableRow").hide(),$("."+e).show())}$("#fhbTimePick").change(function(){filterFhbTable(1)}),$("#fhbFilterPick").change(function(){filterFhbTable(1)}),$("#crTimePick").change(function(){filterFhbTable(2)}),$("#crFilterPick").change(function(){filterFhbTable(2)});function removeAdtend(c){confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E25\u0E1A\u0E1B\u0E23\u0E30\u0E27\u0E31\u0E15\u0E34\u0E19\u0E35\u0E49?")&&$.post("post/v1/deleteAttendance",{attendanceID:c}).then(d=>{log(d),$("#"+c).remove()})}function gotoStdProfile(c){writeCookie("monkeyWebAdminAllstudentSelectedUser",c),self.location="/adminStudentprofile"}function setRemark(c){let e=$(".rm"+c);e.hasClass("next0")?$.post("post/v1/setAttendanceRemark",{attendanceID:c,remark:"0"}).then(f=>{log(f),e.removeClass("next0").addClass("next1"),e.html("<span class='far fa-fw fa-lg fa-times-circle' style='color:red'></span>")}):e.hasClass("next1")?$.post("post/v1/setAttendanceRemark",{attendanceID:c,remark:"1"}).then(f=>{log(f),e.removeClass("next1").addClass("next2"),e.html("<span class='far fa-fw fa-lg fa-check-circle' style='color:orange'></span>")}):e.hasClass("next2")&&$.post("post/v1/setAttendanceRemark",{attendanceID:c,remark:"2"}).then(f=>{log(f),e.removeClass("next2").addClass("next0"),e.html("<span class='far fa-fw fa-lg fa-check-circle' style='color:green'></span>")})}$(".remarkReset").click(function(){confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23 reset remark \u0E17\u0E31\u0E49\u0E07\u0E2B\u0E21\u0E14?")&&$.post("post/v1/resetAttendanceRemark").then(c=>{log(c),location.reload()})});let activityIndicator=!0,acTime1=moment(),acTime2=moment();$(".nav-tabs > .nav-item:nth-child(5)").click(function(){activityIndicator&&genActivityTable(0),activityIndicator=!1}),$("#loadMoreButt").click(function(){genActivityTable(1)});function showAdtendPic(c){$("#picSrc").attr("src",c),$("#picModal").modal("show")}var uploadID;function showUploadModal(c){uploadID=c,$("#picUploadModal").modal("show")}$("#uploadPicButt").click(function(){confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E40\u0E1E\u0E34\u0E48\u0E21\u0E2B\u0E25\u0E31\u0E01\u0E10\u0E32\u0E19\u0E01\u0E32\u0E23\u0E25\u0E32?")&&uploadAdtendPic()});function uploadAdtendPic(){let c=$("#file-img"),d=c.val().split(".").pop().toLowerCase();if(-1===$.inArray(d,["png","jpg","jpeg"]))alert("\u0E01\u0E23\u0E38\u0E13\u0E32\u0E2D\u0E31\u0E1E\u0E44\u0E1F\u0E25\u0E4C .jpg, .jpeg \u0E2B\u0E23\u0E37\u0E2D .png \u0E40\u0E17\u0E48\u0E32\u0E19\u0E31\u0E49\u0E19");else{let e=c.get(0).files,f=new FormData,g=e[0];f.append("files",g,g.name),f.append("attendanceID[]",uploadID),$.ajax({url:"post/v1/uploadAttendanceDocument",type:"POST",data:f,processData:!1,contentType:!1,success:function(){location.reload()}})}}let firstTimeGen=!0;var myChart;generateChart(),$(window).resize(function(){fixWindowHeight()});function fixWindowHeight(){$("#chartContent > .chart-container").height($("#fhbChart").height())}$("#staticChartButt").click(function(){generateChart(1)}),$("#realChartButt").click(function(){generateChart(2)}),$("#compareChartButt").click(function(){generateChart(3)}),$("#smByDayCollapse").collapse("show"),$("#smByCrCollapse").collapse("hide"),$("#smByDayTab").click(function(){$("#smByDayCollapse").collapse("show"),$("#smByCrCollapse").collapse("hide")}),$("#smByCrTab").click(function(){$("#smByDayCollapse").collapse("hide"),$("#smByCrCollapse").collapse("show")}),$("#smDatePicker").datetimepicker({format:"DD/MM/YYYY",daysOfWeekDisabled:[0,6],minDate:moment(0).year(2018).month(2).date(11).hour(23),maxDate:moment(0).year(2018).month(2).date(30).hour(19)}),$("#smDatePicker").on("dp.change",function(){genSmTable()}),$("#smTimePicker").change(function(){genSmTable()}),$("#smFilter").change(function(){filterSmData()}),$(".nav-tabs > .nav-item:nth-child(4)").click(function(){genSmTable(),genSmCrSelectOption()});function filterSmData(){switch($("#smFilter").val()){case"2":$(".smrow-HB").hide(),$(".smrow-CR").show();break;case"3":$(".smrow-HB").show(),$(".smrow-CR").hide();break;default:$(".smrow-HB").show(),$(".smrow-CR").show();}}$("#smCoursePicker").change(function(){"0"!==this.value&&genSmByCrTable()});function smDayToNo(c){return 17>c?c-12:24>c?c-14:c-16}$("#addAttendDatePicker").datetimepicker({format:"DD/MM/YYYY",defaultDate:moment()}),$("#addAttendTypeSelect").change(function(){"1"===this.value?($("#addAttendReasonContainer").show(),$("#addAttendTimeContainer").hide(),genAddAbsentSubj()):"2"===this.value&&($("#addAttendReasonContainer").show(),$("#addAttendTimeContainer").show(),genAddPresentSubj())}),$("#addStdTypeahead").change(function(){calStdQuota(),"1"===$("#addAttendTypeSelect").val()?genAddAbsentSubj():genAddPresentSubj()}),$("#addAttendDatePicker").on("dp.change",function(){"1"===$("#addAttendTypeSelect").val()?genAddAbsentSubj():genAddPresentSubj()}),$("#addAttendQuarterSelect").change(function(){"1"===$("#addAttendTypeSelect").val()?genAddAbsentSubj():genAddPresentSubj()}),initAddAttendData(),$("#addAttendBtn").click(function(){"1"===$("#addAttendTypeSelect").val()?$("#addStdTypeahead").typeahead("getActive")===void 0?alert("Please input student."):null===$("#addAttendSubjSelect").val()?alert("Please input subject."):0>=$("#addAttendReasonInput").val().length?alert("Please input reason."):confirm("Are you sure to add this absent?")&&addNewAbsentAttend():"2"===$("#addAttendTypeSelect").val()&&($("#addStdTypeahead").typeahead("getActive")===void 0?alert("Please input student."):null===$("#addAttendSubjSelect").val()?alert("Please input subject."):confirm("Are you sure to add this present?")&&addNewPresentAttend())}),$("#mathQuotaBtn").click(function(){5<$(this).html().length&&$("#addMQuotaModal").modal("show")}),$("#phyQuotaBtn").click(function(){5<$(this).html().length&&$("#addPQuotaModal").modal("show")}),$("#addMQuotaBtn").click(function(){if($("#addMQuotaInput").val().match(/^[-+]?[0-9]+$/)){let c=$("#addStdTypeahead").typeahead("getActive"),d={};d.studentID=c.id,d.subject="M",d.value=$("#addMQuotaInput").val(),$.post("post/v1/addQuota",d).then(e=>{log(e),calStdQuota(),$("#addMQuotaModal").modal("hide")}).catch(()=>{log("post/v1/addQuota is error."),$("#addMQuotaModal").modal("hide")})}}),$("#addPQuotaBtn").click(function(){if($("#addPQuotaInput").val().match(/^[-+]?[0-9]+$/)){let c=$("#addStdTypeahead").typeahead("getActive"),d={};d.studentID=c.id,d.subject="P",d.value=$("#addPQuotaInput").val(),$.post("post/v1/addQuota",d).then(e=>{log(e),calStdQuota(),$("#addPQuotaModal").modal("hide")}).catch(()=>{log("post/v1/addQuota is error."),$("#addPQuotaModal").modal("hide")})}});