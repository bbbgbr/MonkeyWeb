let getYearAndQuarter=(()=>{var a=_asyncToGenerator(function*(){let[b,c]=yield Promise.all([getConfig(),listQuarter("private")]);for(let d in year=b.defaultQuarter.quarter.year,quarter=b.defaultQuarter.quarter.quarter,c.quarter)c.quarter[d].year===year&&c.quarter[d].quarter===quarter&&(quarterName=c.quarter[d].name,startDate=c.quarter[d].startDate,endDate=c.quarter[d].endDate);genBanner(),getTimetable(),getHistory()});return function(){return a.apply(this,arguments)}})(),getTimetable=(()=>{var a=_asyncToGenerator(function*(){let[b,c]=yield Promise.all([$.post("post/v1/studentTimeTable",{year:year,quarter:quarter,studentID:studentID}),$.post("post/v1/allRoom")]);for(let d in timetable=b,c)room[d]=c[d].room0;fillButton()});return function(){return a.apply(this,arguments)}})(),fillButton=(()=>{var a=_asyncToGenerator(function*(){$("#subjInput").empty(),$(".selector").removeClass("disabled btn-info").addClass("btn-light"),$(".labelor").html("-");let b=$("#addDate").data("DateTimePicker").date();if(0===b.day()||6===b.day()){$("#subjInput").append("<option value='M'>FHB:M</option><option value='P'>FHB:P</option>"),$(".selector").html("\u0E01\u0E14\u0E40\u0E1E\u0E37\u0E48\u0E2D\u0E40\u0E1E\u0E34\u0E48\u0E21"),$(".label-8").html("8-10"),$(".label-10").html("10-12"),$(".label-13").html("13-15"),$(".label-15").html("15-17");let e=timetable.course;for(let g in e){let h=moment(e[g].day);h.day()===b.day()&&$(".btn-"+h.hour()).html("CR:"+e[g].courseName).addClass("disabled")}let f=timetable.hybrid;for(let g in f){let h=moment(f[g].day);h.day()===b.day()&&$(".btn-"+h.hour()).html("FHB:"+f[g].subject).addClass("disabled")}}else{$("#subjInput").append("<option value='M'>FHB:M</option><option value='P'>FHB:P</option><option value='C'>FHB:C</option><option value='E'>FHB:E</option>"),$(".selector").html("-"),$(".btn-8").html("\u0E01\u0E14\u0E40\u0E1E\u0E37\u0E48\u0E2D\u0E40\u0E1E\u0E34\u0E48\u0E21"),$(".btn-10").addClass("disabled"),$(".btn-13").addClass("disabled"),$(".btn-15").addClass("disabled"),$(".label-8").html("16-18");let e=timetable.hybrid;for(let f in e){let g=moment(e[f].day);g.day()===b.day()&&$(".btn-8").html("FHB:"+e[f].subject).addClass("disabled")}}let c=yield $.post("post/v1/listAttendance",{date:b.hour(6).valueOf()}),d={sat8:0,sat10:0,sat13:0,sat15:0,sun8:0,sun10:0,sun13:0,sun15:0,tue17:0,thu17:0};for(let e in c){let f=moment(c[e].date),g=f.format("ddd")+f.hour()+"";if(g=g.toLowerCase(),void 0===c[e].courseID)1===c[e].type?d[g]-=1:d[g]+=1;else{let h=room[g].course;for(let k in h)h.courseID===c[e].courseID&&(d[g]-=1)}}for(let e in room)if(e.slice(0,3)===b.format("ddd").toLowerCase()){let f=$(".btn-"+e.slice(3));room[e].studentCount+d[e]>=room[e].maxStudent&&f.addClass("disabled").html("FULL")}});return function(){return a.apply(this,arguments)}})(),getHistory=(()=>{var a=_asyncToGenerator(function*(){$("#absentTableBody").empty(),$("#presentTableBody").empty();let b=yield $.post("post/v1/listAttendance",{studentID:studentID,studentStartDate:startDate,studentEndDate:endDate});for(let c=0;c<b.length;c++){let d=moment(b[c].date).format("DD/MM/YY - HH:mm"),e;2===b[c].type?(e=$("#presentTableBody"),b[c].courseID===void 0&&e.append("<tr><td class='text-center'>"+d+"</td><td class='text-center'>FHB:"+b[c].subject+"</td><td class='text-center'>"+b[c].sender+"</td></tr>")):(e=$("#absentTableBody"),b[c].courseID===void 0?e.append("<tr><td class='text-center'>"+d+"</td><td class='text-center'>FHB:"+b[c].hybridSubject+"</td><td class='text-center'>"+b[c].sender+"</td></tr>"):e.append("<tr><td class='text-center'>"+d+"</td><td class='text-center'>CR:"+b[c].courseName+"</td><td class='text-center'>"+b[c].sender+"</td></tr>"))}});return function(){return a.apply(this,arguments)}})(),sendData=(()=>{var a=_asyncToGenerator(function*(){$("#loadingModal").modal("show");let b=$("#addDate").data("DateTimePicker").date(),c="\n",d=yield name(studentID);c=c+d.nickname+" "+d.firstname+"\n",c=c+"\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E40\u0E1E\u0E34\u0E48\u0E21: "+b.format("ddd DD/MM/YY")+"\n";let e;e=2===b.day()||4===b.day()?16:classHour($(".btn-info")),c=c+"FHB:"+$("#subjInput").val()+" - "+e+":00",(2===b.day()||4===b.day())&&(e=17);let f=yield $.post("post/v1/listHybridDayInQuarter",{year:year,quarter:quarter}),g;for(let k in f){let l=moment(f[k].day);l.day()===b.day()&&l.hour()===e&&(g=f[k].hybridID)}let h={userID:studentID,date:roundTime(b,e),hybridID:g,subject:$("#subjInput").val(),sender:$("#senderInput").val()};""!==$("#reasonInput").val()&&(c=c+"\n\u0E40\u0E2B\u0E15\u0E38\u0E1C\u0E25: "+$("#reasonInput").val(),h.reason=$("#reasonInput").val()),yield $.post("post/v1/addStudentPresent",h),log("OK"),yield lineNotify("MonkeyAdmin",c),location.reload()});return function(){return a.apply(this,arguments)}})();function _asyncToGenerator(a){return function(){var b=a.apply(this,arguments);return new Promise(function(c,d){function e(f,g){try{var h=b[f](g),k=h.value}catch(l){return void d(l)}return h.done?void c(k):Promise.resolve(k).then(function(l){e("next",l)},function(l){e("throw",l)})}return e("next")})}}let studentID,year,quarter,quarterName,startDate,endDate,timetable,room={sat8:{},sat10:{},sat13:{},sat15:{},sun8:{},sun10:{},sun13:{},sun15:{},tue17:{},thu17:{}},initDate=moment();initDate.date(initDate.date()-1),$("#addDate").datetimepicker({format:"DD/MM/YYYY",daysOfWeekDisabled:[1,3,5],minDate:initDate});let cookies=getCookieDict();studentID=cookies.monkeyWebUser,getYearAndQuarter();function genBanner(){$("#pageBanner").html(quarterName),$("#tableLabel").html("("+quarterName+")")}$("#addDate").on("dp.change",function(){fillButton()}),$(".selector").click(function(){$(this).hasClass("disabled")||($(this).hasClass("btn-light")?($(".selector").removeClass("btn-info").addClass("btn-light"),$(this).removeClass("btn-light").addClass("btn-info")):$(this).toggleClass("btn-light btn-info"))}),$("#submitButt").click(function(){0>=$(".btn-info").length?alert("\u0E01\u0E23\u0E38\u0E13\u0E32\u0E40\u0E25\u0E37\u0E2D\u0E01\u0E40\u0E27\u0E25\u0E32"):""===$("#senderInput").val()?alert("\u0E01\u0E23\u0E38\u0E13\u0E32\u0E43\u0E2A\u0E48\u0E1C\u0E39\u0E49\u0E41\u0E08\u0E49\u0E07"):confirm("\u0E22\u0E37\u0E19\u0E22\u0E31\u0E19\u0E01\u0E32\u0E23\u0E40\u0E1E\u0E34\u0E48\u0E21?")&&sendData()});const roundTime=(a,b)=>{let c=moment(0);return c.year(a.year()).month(a.month()).date(a.date()).hour(parseInt(b)),c.valueOf()},classHour=a=>{let b=0;return a.hasClass("btn-8")?b=8:a.hasClass("btn-10")?b=10:a.hasClass("btn-13")?b=13:a.hasClass("btn-15")&&(b=15),b};