let getCourse=(()=>{var a=_asyncToGenerator(function*(){let b=getCookieDict(),[c,d]=yield Promise.all([getConfig(),listQuarter("public")]);for(let k in year=c.defaultQuarter.registration.year,quarter=c.defaultQuarter.registration.quarter,d.quarter)d.quarter[k].year===year&&d.quarter[k].quarter===quarter&&($("#absentHeader").html("\u0E41\u0E1A\u0E1A\u0E1F\u0E2D\u0E23\u0E4C\u0E21\u0E25\u0E32 "+d.quarter[k].name),$("#presentHeader").html("\u0E41\u0E1A\u0E1A\u0E1F\u0E2D\u0E23\u0E4C\u0E21\u0E0A\u0E14\u0E40\u0E0A\u0E22 "+d.quarter[k].name));let e=moment(0).year(2018).month(2).date(12).hour(6),f=moment(0).year(2018).month(2).date(30).hour(23),[g,h]=yield Promise.all([$.post("post/v1/studentTimeTable",{year:year,quarter:quarter,studentID:b.monkeyWebUser}),$.post("post/v1/listAttendance",{studentStartDate:e.valueOf(),studentEndDate:f.valueOf(),studentID:b.monkeyWebUser})]);timeTable=g,enableBtn(g),fillHistory(h)});return function(){return a.apply(this,arguments)}})(),removeHistory=(()=>{var a=_asyncToGenerator(function*(b){$("#waiting").modal("show");let c=yield $.post("post/v1/deleteAttendance",{attendanceID:b});log(c),location.reload()});return function(){return a.apply(this,arguments)}})(),addAbsent=(()=>{var a=_asyncToGenerator(function*(b,c){$("#waiting").modal("show");let d={},e=getCookieDict();d.userID=e.monkeyWebUser,d.reason="SummerAbsent",d.sender="\u0E1C\u0E1B\u0E04.",d.courseID=b,d.date=c.valueOf();let f=yield $.post("post/v1/addStudentAbsent",d);log(f),location.reload()});return function(){return a.apply(this,arguments)}})(),addPresent=(()=>{var a=_asyncToGenerator(function*(b,c){$("#addPresentModal").modal("hide"),$("#waiting").modal("show");let d={},e=getCookieDict();d.userID=e.monkeyWebUser,d.date=c.valueOf(),d.courseID=b,d.sender="\u0E1C\u0E1B\u0E04.";let f=yield $.post("post/v1/addStudentPresent",d);log(f),location.reload()});return function(){return a.apply(this,arguments)}})();function _asyncToGenerator(a){return function(){var b=a.apply(this,arguments);return new Promise(function(c,d){function e(f,g){try{var h=b[f](g),k=h.value}catch(l){return void d(l)}return h.done?void c(k):Promise.resolve(k).then(function(l){e("next",l)},function(l){e("throw",l)})}return e("next")})}}let year,quarter,timeTable;getCourse();function enableBtn(a){for(let b in a.course){let c=moment(a.course[b].day);$(".btn-"+c.hour()).removeClass("disabled")}}function fillHistory(a){for(let b in a)if(1===a[b].type){if("SummerAbsent"===a[b].reason){let c=moment(a[b].date);$("#a"+c.format("DD-HH")).addClass("btn-danger AID"+a[b]._id).removeClass("btn-light")}}else if(2===a[b].type)for(let c in timeTable.course)if(a[b].courseID===timeTable.course[c].courseID){let d=moment(a[b].date);$("#p"+d.format("DD-HH")).addClass("btn-info AID"+a[b]._id).removeClass("btn-light")}}$(".btn-a").click(function(){if($(this).hasClass("btn-danger")){if(confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E25\u0E1A\u0E1B\u0E23\u0E30\u0E27\u0E31\u0E15\u0E34\u0E01\u0E32\u0E23\u0E25\u0E32\u0E19\u0E35\u0E49?")){let a=this.className.slice(this.className.indexOf("AID")+3,this.className.indexOf("AID")+27);removeHistory(a)}}else if($(this).hasClass("btn-light")&&!$(this).hasClass("disabled")){let b,c,a=moment(0).year(2018).month(2).date(parseInt(this.id.slice(1,3))).hour(parseInt(this.id.slice(4)));for(let d in timeTable.course){let e=moment(timeTable.course[d].day);e.hour()===a.hour()&&(b=timeTable.course[d].courseName,c=timeTable.course[d].courseID)}confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E25\u0E32\u0E04\u0E2D\u0E23\u0E4C\u0E2A "+b+"?")&&addAbsent(c,a)}}),$(".btn-p").click(function(){if($(this).hasClass("btn-light")){let a=moment(0).year(2018).month(2).date(parseInt(this.id.slice(1,3))).hour(parseInt(this.id.slice(4)));$(".btn-info").length>=$(".btn-danger").length?alert("\u0E44\u0E21\u0E48\u0E2A\u0E32\u0E21\u0E32\u0E23\u0E16\u0E40\u0E1E\u0E34\u0E48\u0E21\u0E21\u0E32\u0E01\u0E01\u0E27\u0E48\u0E32\u0E08\u0E33\u0E19\u0E27\u0E19\u0E17\u0E35\u0E48\u0E25\u0E32\u0E44\u0E14\u0E49"):confirm("\u0E22\u0E37\u0E19\u0E22\u0E31\u0E19\u0E01\u0E32\u0E23\u0E0A\u0E14\u0E40\u0E0A\u0E22?")&&addPresent(timeTable.course[0].courseID,a)}else if($(this).hasClass("btn-info")&&confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E25\u0E1A\u0E1B\u0E23\u0E30\u0E27\u0E31\u0E15\u0E34\u0E01\u0E32\u0E23\u0E0A\u0E14\u0E40\u0E0A\u0E22\u0E19\u0E35\u0E49?")){let a=this.className.slice(this.className.indexOf("AID")+3,this.className.indexOf("AID")+27);removeHistory(a)}});